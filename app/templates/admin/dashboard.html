{% extends "base.html" %}

{% block title %}Admin Dashboard - T-Shirt Store{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="admin-brand">
            <h2>Admin Panel</h2>
        </div>
        <nav class="admin-nav">
            <a href="{{ url_for('admin.admin_dashboard') }}" class="nav-item active">
                <span class="icon">üìä</span>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('admin.admin_products') }}" class="nav-item">
                <span class="icon">üì¶</span>
                <span>Products</span>
            </a>
            <a href="#" class="nav-item">
                <span class="icon">üõçÔ∏è</span>
                <span>Orders</span>
            </a>
            <a href="#" class="nav-item">
                <span class="icon">üë•</span>
                <span>Users</span>
            </a>
            <a href="{{ url_for('main.index') }}" class="nav-item">
                <span class="icon">üè†</span>
                <span>Back to Store</span>
            </a>
        </nav>
    </aside>

    <main class="admin-main">
        <div class="admin-header">
            <h1>Dashboard Overview</h1>
            <div class="admin-user">
                <span>Welcome, {{ current_user.username }}</span>
            </div>
        </div>

        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3>Total Revenue</h3>
                    <p class="stat-value">${{ "%.2f"|format(total_revenue or 0) }}</p>
                    <span class="stat-change positive">+12.5% from last month</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üõçÔ∏è</div>
                <div class="stat-info">
                    <h3>Total Orders</h3>
                    <p class="stat-value">{{ total_orders or 0 }}</p>
                    <span class="stat-change positive">+8.3% from last month</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-info">
                    <h3>Products</h3>
                    <p class="stat-value">{{ total_products or 0 }}</p>
                    <span class="stat-change neutral">{{ active_products or 0 }} active</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <h3>Customers</h3>
                    <p class="stat-value">{{ total_users or 0 }}</p>
                    <span class="stat-change positive">+15 new this week</span>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Recent Orders</h2>
                    <a href="#" class="btn btn-sm">View All</a>
                </div>
                <div class="table-responsive">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if recent_orders %}
                                {% for order in recent_orders %}
                                    <tr>
                                        <td>#{{ order.order_number }}</td>
                                        <td>{{ order.user.username }}</td>
                                        <td>{{ order.created_at.strftime('%b %d, %Y') }}</td>
                                        <td>${{ "%.2f"|format(order.total_amount) }}</td>
                                        <td><span class="status-badge status-{{ order.status }}">{{ order.status }}</span></td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center">No orders yet</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Low Stock Products</h2>
                    <a href="{{ url_for('admin.admin_products') }}" class="btn btn-sm">Manage</a>
                </div>
                <div class="low-stock-list">
                    {% if low_stock_products %}
                        {% for product in low_stock_products %}
                            <div class="stock-item">
                                <img src="{{ url_for('static', filename=product.image_url) if product.image_url else url_for('static', filename='images/placeholder.jpg') }}" alt="{{ product.name }}">
                                <div class="stock-info">
                                    <h4>{{ product.name }}</h4>
                                    <p class="stock-qty {% if product.stock_quantity == 0 %}out-of-stock{% else %}low-stock{% endif %}">
                                        {{ product.stock_quantity }} in stock
                                    </p>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-center">All products are well stocked!</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
                <h2>Sales Chart</h2>
                <select class="form-control" style="width: auto;">
                    <option>Last 7 Days</option>
                    <option>Last 30 Days</option>
                    <option>Last 90 Days</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="salesChart"></canvas>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('salesChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Sales',
                    data: [120, 190, 300, 500, 200, 300, 450],
                    borderColor: '#3a86ff',
                    backgroundColor: 'rgba(58, 134, 255, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
